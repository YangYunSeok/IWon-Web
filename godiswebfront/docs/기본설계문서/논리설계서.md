---

# 관리자 코인 관리 시스템 논리 설계서 (Admin Web)

(2026-01-14 기준, v0.1)

## 1. 논리 구조 개요

본 시스템은 **“코인 가치 이동 SoT = 스마트컨트랙트 서비스(SC Service)”**를 전제로 한다.
관리자 웹(Admin Web)은 **승인·통제·조회·결산**을 담당하며, 코인 발행/소각/전송의 최종 확정(원장/Tx)은 SC Service가 수행한다. 

또한 Admin Web의 대부분 조회 화면은 **이벤트 기반 적재(Projection) 또는 관리 DB**를 조회하며, **eventual consistency**(처리중/지연 반영)를 전제로 UI 상태를 표현한다. (대시보드의 불일치 경고, pending 트랜잭션 모니터링 등)

---

## 2. 논리 컴포넌트/컨텍스트

### 2.1 컴포넌트

* **Admin Web(UI)**: React 기반 관리자 콘솔 화면(대시보드/지갑/지급·회수/승인/거래/월별지급/결산)
* **Admin API(백엔드)**: Admin Web용 인증/권한(RBAC), 요청 생성, 승인 처리, 조회 API 제공 
* **SC Service(SoT)**: 코인 가치 이동(발행/소각/전송)의 최종 실행/확정 및 원장 책임
* **Admin DB / Projection DB**

  * Admin DB: 관리자 계정/권한, 승인 워크플로우, 실행 결과, 감사 로그, 월별 지급 계획/대상자 등 관리 데이터 저장 
  * (선택) Projection DB: 온체인 이벤트/실행 결과 기반 조회 최적화 저장소(거래 이력, 잔액 스냅샷 등)
* (선택) **메시지 브로커**: SC 이벤트 전달 및 적재 안정성 강화(참조 설계와 동일 패턴) 

---

### 2.2 책임 분리(Ownership)

#### Admin Web(UI)

* 사용자 입력/검증(폼 레벨)
* 역할(Operator/Approver/Viewer) 기반 화면 노출/동작 제어
* eventual consistency 전제의 상태 표기(승인대기/처리중/성공/실패, 불일치 경고 등)

#### Admin API(백엔드)

* 인증/권한: Bearer Token + Role 기반 접근제어 
* **요청 생성**(Mint/Burn 요청 등): 승인 대상 레코드(Approval) 생성 및 대상자(ApprovalTargets) 구성
* **승인 처리**: 승인 확정/반려, 실행 트리거(외부 SC 호출), 실행 결과 기록(AdminTransaction), 감사 로그 기록
* **조회(Query)**: 대시보드 지표/거래 이력/승인 목록/상세/월별 지급 대상자 등 조회 API 제공 

#### SC Service(SoT)

* Mint/Burn/Transfer 등 코인 가치 이동 실행 및 최종 확정
* txHash/블록 정보 등 실행 결과 확정
* 이벤트 발행(가능 시) 및 Projection 적재 제어(선택)

---

## 3. 주요 논리 기능

### 3.1 인증/권한(RBAC)

* 인증: `Authorization: Bearer <adminAccessToken>` 
* 역할(개념): `operator / approver / viewer` 및 권한 코드:

  * `ROLE_ADMIN_OPERATOR`(요청 생성/관리)
  * `ROLE_ADMIN_APPROVER`(승인/확정/감사, 결산 권장)
  * `ROLE_ADMIN_VIEWER`(조회 전용)

### 3.2 코인 지급/회수 요청 생성(명령: Command)

* Mint 요청 생성: `POST /admin/mint/request` → `ApprovalRequest` 반환 
* Burn 요청 생성: `POST /admin/burn/request` → `ApprovalRequest` 반환 
* 요청 생성은 **Operator 책임**이며, 실제 실행은 승인 이후로 분리된다(SoD/통제).

### 3.3 승인 처리(명령: Command)

* 승인 목록: `GET /admin/approvals`
* 승인 상세: `GET /admin/approvals/{approvalId}`
* 승인 확정(실행 트리거): `POST /admin/approvals/{approvalId}/confirm` → `AdminTransaction`
* 승인 반려: `POST /admin/approvals/{approvalId}/reject`(반려 사유 필수)

> 승인 상세는 유형별 확장 필드(정산요약/전환정보/mint·burn 비교·사전검증, 첨부/타임라인)를 포함한다. 

### 3.4 조회(Query)

* 거래 이력: `GET /admin/transactions` (기간/from-to, 유형, 코인, keyword) 
* 월별 지급 대상자:

  * 목록: `GET /admin/monthly-payees`
  * 등록/수정: `POST /admin/monthly-payees/{id}`
  * 확정: `DELETE /admin/monthly-payees/{year}-{month}/confirm`
  * 내보내기: `GET /admin/monthly-payees/export?...` 
* 대시보드:

  * 총 발행량/정합성: `GET /admin/stats/supply`
  * 금일 지표: `GET /admin/stats/daily`

### 3.5 재무회계결산(조회/다운로드 중심)

* UI/업무 구조는 정의돼 있으나, **API 스펙은 “백엔드 확정 필요”로 명시**되어 있음
* 탭 구성(2개):

  1. 재무회계분개(결산대상: 발행/소각 승인내역)
  2. 결산보고서(요약 + 준비금/발행부채 포함)
* 다운로드 정책: “현재 탭 + 선택 기간” 기준

---

## 4. 논리 데이터/도메인 모델

> 데이터 모델의 **UI/DTO 표준**은 `api_및_데이터모델_명세서(관리자용).md`를 SSOT로 한다. 

### 4.1 핵심 엔티티(개념+논리)

* **EmployeeWallet**

  * employeeId, name, department, position, walletAddress?, walletStatus 
* **ApprovalRequest / ApprovalDetail**

  * approvalId, type, requesterType, amount, status, requestedAt
  * detail: attachments, timeline, (유형별) summary/conversion/mintBurn 
* **AdminTransaction**

  * txId, txHash?, type, coinType, amount, status(pending/success/failed), createdAt 
* **MonthlyPayee**

  * (year, month, employeeId, coinType, amount, status, scheduledAt?, paidAt?)

### 4.2 주요 Enum/상태 모델

* WalletStatus: uncreated / active / frozen
* ApprovalStatus: pending / approved / rejected
* ApprovalType: settlement / naverpayConversion / mint / burn
* AdminTransaction.status: pending / success / failed 
* MonthlyPlanStatus: draft / confirmed, MonthlyPayeeStatus: scheduled / paid / cancelled

### 4.3 엔티티 관계(논리)

DB 권장 스키마를 기준으로 논리 관계를 정리하면:

* Approval(1) : ApprovalTargets(N)
* Approval(1) : AdminTransactions(N or 1..N) — 승인 실행 결과(재시도/분할 실행 가능성 대비) 
* Wallet(1) : WalletTransactions(N) — 거래 원장/프로젝션 
* MonthlyPlans(1) : MonthlyPayees(N) — 월별 확정/대상자

---

## 5. 데이터 적재/일관성(Projection) 논리

### 5.1 조회 데이터 원천

* 승인/월별지급/감사로그 등 “관리 워크플로우”는 **Admin DB**가 원천
* 온체인 실행 결과( txHash, 성공/실패 ) 및 거래 이력은

  * (A) Admin API가 SC Service 호출 결과를 AdminTransactions에 기록하거나
  * (B) SC 이벤트를 수신해 Projection DB로 적재(선택)하는 모델을 취한다. 

### 5.2 Eventual Consistency 규칙(운영/UX)

* 승인 확정 직후라도 **거래 이력/잔액/집계가 즉시 반영되지 않을 수 있다.**
* UI는 상태를 다음처럼 표기한다:

  * ApprovalStatus(결정 상태)와 AdminTransaction.status(실행 상태)를 분리 표시
  * 대시보드 불일치/경고 코드 기반 알림(예: DISCREPANCY_DETECTED)

---

## 6. 트랜잭션/오류 처리(논리)

### 6.1 승인 확정 처리의 원자성(권장)

DB 테이블 설계 권고에 따라, 승인 확정(Confirm)은 다음 순서의 **논리 트랜잭션**으로 처리한다:

1. approvals.status 갱신(approved)
2. admin_transactions 생성(pending)
3. (필요 시) wallet_transactions 생성/적재
4. audit_logs 기록 

### 6.2 오류 코드/검증(UX 연계)

공통 오류 코드를 기반으로 UI 처리 일관성을 유지한다(권한/불일치/준비금부족/지갑미생성 등).

---

## 7. 화면/프로세스(논리 시나리오)

### 7.1 Mint/Burn (Operator → Approver)

1. Operator가 대상자 선택 후 Mint/Burn 요청 생성
2. 시스템은 Approval(pending) 생성
3. Approver가 승인 관리에서 상세 확인 후 confirm/reject
4. confirm 시 AdminTransaction 생성 및 SC 실행 트리거
5. TxHistory에서 txHash/상태 확인, 대시보드 집계 반영

### 7.2 월별 지급 대상자 관리(Operator)

* 월별 대상자 등록/수정/삭제 → 확정(confirm) → (권장) 승인/지급 프로세스와 연계

### 7.3 재무회계결산(Approver/재무)

* 기간 선택 → 탭별 조회(분개/요약/준비금·부채) → 탭+기간 기준 다운로드
* 단, 결산 API는 확정 필요(현 문서 범위에서는 “논리 인터페이스만 정의”) 

---

## 8. 논리 설계 원칙 요약

* **SoT는 SC Service**, Admin Web은 통제/감사/결산 중심
* **Command(요청/승인/실행)와 Query(조회)를 분리**하고, Query는 eventual consistency를 전제로 한다.
* 역할 분리(SoD)와 감사 로그를 기본 전제로 한다.

---