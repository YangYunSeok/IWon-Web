# 관리자 웹 화면 / 기능 / API / DB 정리 (v0.3)

---

## 0. 전체 관리자 업무 흐름 요약 (Overview)

```text

결제코인
월별 지급 대상자 관리 → 코인 지급 관리 (지급 요청 생성)  → 승인 관리 (온체인 반영 여부 결정)  → 거래 이력 조회 (결과 확인) → 대시보드 (집계/모니터링)
```

* 모든 코인 이동은 **요청 → 승인 → 체인 반영 → 이력 기록** 순서
* 관리자는 직접 체인을 조작하지 않으며, **승인 관리 화면이 최종 통제 지점**

---

## 0.1 권한 정책 (SoD)

* 작성자(ROLE_ADMIN_OPERATOR): 요청 생성·관리
* 승인자(ROLE_ADMIN_APPROVER): 승인/확정/감사
* 공통(ROLE_ADMIN_VIEWER): 조회 전용(외 공통 화면)

---

## 0.2 공통 조회/검색 정책 (Dashboard 제외)

대시보드를 제외한 **모든 화면의 “조회(리스트/테이블)” 기능**은 아래 공통 검색 정책을 따른다.

### 공통 검색 조건

* **부서(조직) 필터**: 부서(또는 부서 트리) 기준으로 대상자를 좁혀서 조회 가능
* **이름 검색**: 이름 기준 부분일치 검색 지원
* (권장) **키워드 검색**: `이름/사번/이메일` 등 화면 성격에 맞는 사용자 식별자를 함께 검색할 수 있도록 확장 가능
* (선택) 기간/상태/유형 등 **화면별 추가 필터**는 각 화면 요구에 맞게 별도 제공

### 공통 UX

* 상단에 검색 조건 영역 제공(필터/검색어 입력/조회/초기화)
* 조건 변경 후 “조회(Search)” 버튼으로 조회 실행(불필요한 자동조회 최소화)
* 결과는 페이징/정렬 지원(테이블)
* 데이터 없음/오류 표시는 공통 메시지 규칙을 따른다

---

## 1. Dashboard

* 파일명: `STOCOIN01S1.jsx`

### 주요 기능 (Excel 기준)

* 총 발행량 / 코인별 합계
* 금일 주요 지표
* DB vs 온체인 불일치 안내
* Pending Transaction 모니터링

### 연계 API

* `GET /admin/stats/supply`
* `GET /admin/stats/daily`

### 권한

* 접근 권한: `ROLE_ADMIN_VIEWER`
* 대상 역할:
  - 작성자(ROLE_ADMIN_OPERATOR)
  - 승인자(ROLE_ADMIN_APPROVER)

---

## 2. 임직원 지갑 관리 (Wallet Management)

* 파일명: `STOCOIN02S1.jsx`

### 주요 기능 (Excel 기준)

* 임직원 지갑 조회
* 지갑 생성
* 지갑 상태 관리

### 공통 조회/검색 (Wallet Management)

* 0.2 공통 조회/검색 정책 적용(부서/이름 등 필터로 대상자 검색)

### 연계 API

* `GET /admin/employees`
* `POST /admin/wallets/create`

### 권한

* 접근 권한: `ROLE_ADMIN_OPERATOR`
* 대상 역할:
  - 작성자(요청 생성자)

---

## 3. 코인 지급/회수 (CoinDist)

* 파일명: `STOCOIN03S1.jsx`

### 주요 기능 (Excel 기준)

* 지급(Mint) / 회수(Burn) 요청 생성
* 일괄 지급(Bulk)

### 공통 조회/검색 (CoinDist)

* 0.2 공통 조회/검색 정책 적용(부서/이름 등 필터로 대상자 검색)

### 연계 API

* `POST /admin/mint/request`
* `POST /admin/burn/request`

### 권한

* 접근 권한: `ROLE_ADMIN_OPERATOR`
* 대상 역할:
  - 작성자(요청 생성자)

### 비고

* 일괄 업로드 전용 API 미정

---

## 4. 거래 이력 조회 (TxHistory)

* 파일명: `STOCOIN04S1.jsx`

### 주요 기능 (Excel 기준)

* 트랜잭션 내역 조회
* 상태/유형/금액/TxHash 확인

### 공통 조회/검색 (TxHistory)

* 0.2 공통 조회/검색 정책 적용(부서/이름 등 필터로 대상자/요청 주체 검색)

### 연계 API

* `GET /admin/transactions`

### 권한

* 접근 권한: `ROLE_ADMIN_VIEWER`
* 대상 역할:
  - 작성자(ROLE_ADMIN_OPERATOR)
  - 승인자(ROLE_ADMIN_APPROVER)

---

## 5. 승인 관리 (Approval)

* 파일명: `STOCOIN05S1.jsx`

### 역할 정의

* 모든 승인 대상 요청의 **단일 진입점**
* 웹에서는 요청을 생성하지 않음
* 외부(앱/시스템)에서 생성된 요청을 승인/반려

---

### 5.1 승인 목록

**승인 유형**

* 가맹점 정산요청 (앱에서 생성)
* 복지코인 → 네이버페이 전환 요청
* 코인 지급(Mint)
* 코인 회수(Burn)

**목록 표시 항목**

* 요청 유형
* 요청 주체 (가맹점 / 시스템 / 관리자)
* 가맹점명 또는 대상자
* 요청 금액
* 요청 일시
* 상태 (승인대기 / 승인 / 반려)

---

### 공통 조회/검색 (Approval)

* 0.2 공통 조회/검색 정책 적용(부서/이름 등 필터로 대상자/요청 주체 검색)

---

### 5.2 승인 상세

#### 가맹점 정산요청

* 가맹점 정보
* 정산 기간
* 거래 요약

  * 거래 건수
  * 총 거래 금액
  * 수수료
  * 정산 대상 금액
* 첨부 / 증빙 자료
* 승인 / 반려 (반려 사유 필수)
* 승인 이력 타임라인
* (선택) 정산 내역 엑셀 다운로드

#### 복지코인 → 네이버페이 전환

* 대상자
* 전환 금액
* 전환 사유
* 첨부 자료
* 승인 / 반려

---

### 연계 API

* `GET /admin/approvals`
* `GET /admin/approvals/{approvalId}`
* `POST /admin/approvals/{approvalId}/confirm`
* `POST /admin/approvals/{approvalId}/reject`

---

### 권한

* 승인 처리: `ROLE_ADMIN_APPROVER`
* 조회 전용: `ROLE_ADMIN_OPERATOR`

---

## 6. 월별 지급 대상자 관리 (Monthly Payment Planning)

* 파일명: `STOCOIN06S1.jsx`

### 주요 기능 (Excel 기준)

* 월별 지급 대상자 조회
* 일괄 등록/수정/삭제
* 전월 데이터 Import
* 지급 확정(Approval 연계 권장)

### 공통 조회/검색 (Monthly Payment Planning)

* 0.2 공통 조회/검색 정책 적용(부서/이름 등 필터로 대상자 검색)

### 연계 API

* `GET /admin/monthly-payees` (월지급 대상자 조회)
* `POST /admin/monthly-payees/{id}` (월지급 대상자 등록/수정)
* `PUT /admin/monthly-payees/bulk-delete` (월지급 대상자 삭제)
* `DELETE /admin/monthly-payees/{year}-{month}/confirm` (월지급 대상자 확정)


### 권한

* 접근 권한: `ROLE_ADMIN_OPERATOR`
* 대상 역할:
  - 작성자(요청 생성자)

---
## 7. 재무회계결산 관리 (Financial Closing)

* 파일명: `STOCOIN07S1.jsx`

---

### 7.0 공통 정책 (Common)

#### 화면 구조
- 상단: 기준 기간 선택(월/분기/반기/년) + 조회/초기화 + 다운로드
- 중단: 탭(Tab) 영역 (결산 기능별 전환)
- 하단: 선택된 탭 결과 (요약 + 테이블)

#### 공통 UX/기능
- 조회 전용(Read-only)  
  (단, 결산 확정/마감 기능을 도입할 경우 별도 권한/프로세스 정의 필요)
- 기간 필터 기본값: 최근 마감 월(또는 최근 1개월)
- “조회” 버튼으로 데이터 갱신
- “Excel 다운로드” 제공 (탭별 산출물 형태 상이할 수 있음)
- 데이터 없음: “조회된 데이터가 없습니다”
- 오류: 공통 오류 메시지(Toast/MessageBox)

#### 권한
- 기본 접근 권한: `ROLE_ADMIN_APPROVER` 권장
- 재무/감사 정책에 따라 별도 재무 역할(Role) 분리 가능

---

### 7.1 탭 구성 (Tabs)

재무회계결산 관리는 아래 **2개 탭**으로 구성한다.

A) 재무회계분개 (결산대상: 발행/소각 승인내역)
B) 결산보고서

> 탭 전환 시 기간 조건은 유지한다.

---

### 7.2 탭 A. 재무회계분개 (결산대상: 발행/소각 승인내역)

#### 목적
결산 기간에 대해 *“어떤 이벤트가 어떤 분개로 잡히는지”*를 보여주는 근거 화면(원천→분개)

#### MVP(1차) 포함

- 기간 선택(월 기준 추천) + 코인구분(포인트/결제)
- 요약 카드: 총 발행/소각 건수, 금액, 순발행, 예상 분개 라인 수
- 데이터 원천/매핑(명확화)
  - 결산대상 “이벤트”는 승인 유형 기준: 발행 = `ApprovalType.mint`, 소각 = `ApprovalType.burn`
  - “승인ID” = `approvalId`
  - “승인일시”(MVP) = 승인요청 생성 시각 `requestedAt` (승인 처리 시각이 필요하면 추후 `approvedAt` 등으로 확장)
  - “상태” = `ApprovalStatus` (`pending`/`approved`/`rejected`)
- 리스트(핵심)
  - 승인ID / 승인일시 / 코인구분 / 이벤트(발행|소각) / 수량·금액 / 상태
  - “분개 미리보기”(차/대 계정 + 금액)
- 상세(드로어/모달): 이벤트 원천 + 분개 라인(차/대) 2~n줄

---

### 7.3 탭 B. 결산보고서

#### 목적
위 분개/스냅샷을 기반으로 “요약 보고서” 제공(경영/회계용)

#### MVP(1차) 포함

- 기간/코인구분 선택
- 보고서 요약(표 1~2개)
- 준비금 잔액(기초/증감/기말)
- 발행부채 현황(기초/증감/기말)
- (가능하면) 발행/소각 집계표
- 다운로드(CSV/Excel): “데이터 덤프” 수준으로만 먼저

---

### 7.4 다운로드 정책

- 다운로드는 “현재 탭 + 선택 기간” 기준으로 수행
- 파일명 예시:
  - `FIN_CLOSE_{TAB}_{YYYYMM}.xlsx`
  - `FIN_CLOSE_{TAB}_{YYYYQ}.pdf`

---

### 7.5 승인/거래 화면과의 관계

- 승인 관리(Approval): 개별 요청 승인/반려 (업무 처리)
- 거래 이력(TxHistory): 트랜잭션 단위 상세 조회
- 재무회계결산 관리(본 화면): 승인·거래 결과를 회계 관점으로 재구성하여 결산 산출물 제공
