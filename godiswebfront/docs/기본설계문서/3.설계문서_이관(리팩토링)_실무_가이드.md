# 설계 문서 이관(리팩토링) 실무 가이드

## 2️⃣ MCP + Codegen 환경에서의 설계문서 구조

### ✅ 물리적 분리 + 논리적 통합


* 파일은 나눈다 (변경 단위 최소화)
* 기준은 하나다 (SSOT 유지)
* 기존에 있는 Front-End(APP)문서의 추가한다.
* 새로 생성되는 파일은 반드시 파일명 앞 부분에 'web-'를 붙여서 구분한다.

### 권장 구조 

```
workspace/docs/design
 ├─ api/
 │   ├─ auth.md
 │   ├─ merchant-payments.md
 │   ├─ merchant-settlements.md
 │   └─ wallet.md
 │
 ├─ model/
 │   ├─ common-types.md
 │   ├─ merchant.md
 │   ├─ transaction.md
 │   └─ settlement.md
 │
 ├─ ui/
 │   ├─ merchant/
 │   │   ├─ MerchantHome.md
 │   │   ├─ MerchantTransactions.md
 │   │   └─ MerchantSettlement.md
 │   └─ user/
 │       └─ UserHome.md
 │
 └─ _index.md   ← ★ 논리적 SSOT 허브
```

## 3️⃣ 각 문서의 “역할 경계” (중요)

### API 명세서의 책임

* **무엇을 주고받는가**
* Path / Method / Auth
* Request / Response
* Status / Error / Pagination
* Codegen의 **직접 입력**

👉 **기계 친화적, 감정 없음**

### 모델링 문서의 책임

* **이 시스템에 어떤 개념이 존재하는가**
* 필드 의미, 관계
* 상태 전이(ProcessStatus 등)
* 비즈니스 규칙(금액, 한도, 불변성)

👉 **사람과 AI가 함께 이해**

### UI 문서의 책임

* **언제 어떤 API를 호출하는가**
* 화면 진입 시점
* 로딩/에러/빈 상태
* 서버 canonical 값 → UI 표시 매핑

👉 **프론트 + QA 기준 문서**

## 4️⃣ “논리적 SSOT”는 어디에 두느냐

여기서 핵심이 `_index.md`입니다.

### `_index.md`의 역할

* 이 프로젝트에서 **무엇이 진실인가** 선언
* 문서 간 우선순위 정의
* 변경 시 영향 범위 규칙

예시:

```md
## SSOT 규칙

1. API 계약의 1차 근거는 docs/design/api/*
2. 모델 의미는 docs/model/* 을 따른다
3. UI 표시는 docs/ui/* 을 따른다
4. 충돌 시 우선순위: api → model → ui
5. Codegen 입력은 api 문서만 사용한다
```

👉 이 한 장이 **문서 분리의 부작용을 제거**합니다.

## 5️⃣ Codegen / MCP 기준으로 보면 더 명확해짐

| 구분         | API | Model   | UI |
| ---------- | --- | ------- | -- |
| Codegen 입력 | ✅   | ⚠️ (참조) | ❌  |
| MCP 컨텍스트   | ✅   | ✅       | ✅  |
| 변경 빈도      | 중   | 낮음      | 높음 |
| 리뷰 난이도     | 중   | 낮음      | 높음 |

그래서:

* Codegen은 API만 먹고
* MCP는 전부 읽고
* 사람은 역할별로 나눠 본다

이 구조가 **인지 부하 최소 + 자동화 최대**입니다.

좋아, 그럼 **지금 보유한 문서를 버리지 않고**,
**MCP + Codegen에 최적화된 구조로 “이관(리팩토링)”하는 기준**을
실무에서 바로 적용 가능한 **가이드 문서 형태**로 정리해줄게요.

핵심은 이겁니다.

> ❌ 새로 쓰지 않는다
> ❌ 형식을 바꾸지 않는다
> ✅ 위치와 책임만 바로 잡는다

# 나. 설계 문서 이관(리팩토링) 실무 가이드

*(SSOT 유지 + MCP/Codegen 친화 구조)*

## 0️⃣ 이관 원칙 선언 (반드시 합의)

이관 작업을 시작하기 전에 **팀 합의 문장**을 문서 상단에 명시합니다.

```md
본 프로젝트의 설계 문서는 물리적으로 분리하되,
논리적으로 하나의 SSOT(Single Source Of Truth)를 유지한다.

문서 이동은 의미 변경이 아니라
“책임 경계 정리”를 목적으로 한다.
```

이 문장이 없으면 이관은 100% 실패합니다.

## 1️⃣ 이관 대상 문서 분류 기준 (판단표)

지금 있는 문서를 **내용 기준으로 잘라서 이동**합니다.
파일 단위로 옮기지 말고, **섹션 단위**로 판단합니다.

### 판단 기준 표

| 이 내용은 무엇을 설명하나        | 이동 위치         |
| --------------------- | ------------- |
| HTTP Method / Path    | `docs/design/api/`   |
| Request / Response 필드 | `docs/design/api/`   |
| Error code / Status   | `docs/design/api/`   |
| 엔티티 필드 의미             | `docs/model/` |
| 상태값의 의미               | `docs/model/` |
| 비즈니스 규칙               | `docs/model/` |
| 화면 구성                 | `docs/ui/`    |
| 화면 진입 시 API 호출        | `docs/ui/`    |
| 로딩/에러 UX              | `docs/ui/`    |

👉 **한 섹션이 두 개 이상에 걸리면 반드시 쪼갠다**

## 2️⃣ API 문서로 이관하는 기준 (Codegen 핵심)

### API 문서에 남겨야 할 것

* Endpoint 단위 설명
* `@codegen` Marker
* METHOD / PATH / AUTH
* Request / Response Table
* Status / Error

### API 문서에서 제거할 것

* 화면 이름 (`MerchantHome에서 호출`)
* UI 표시 문구
* “현재 화면에서는…” 같은 문장

#### ❌ 제거 예시

```md
이 API는 MerchantHome 화면에서 QR 생성 버튼을 눌렀을 때 호출된다.
```

#### ⭕ UI 문서로 이동

```md
MerchantHome 진입 후
[QR 코드 생성] 버튼 탭 시
POST /merchant/payment-requests 호출
```

## 3️⃣ 모델 문서로 이관하는 기준 (의미의 집합소)

모델 문서는 **“왜 이 필드가 존재하는가”**를 설명합니다.

### 모델 문서에 남겨야 할 것

* 엔티티 정의
* 필드 의미
* 상태값 의미
* 불변 조건

#### 예시

```md
## MerchantSettlement

- settlementId
  - 정산 요청의 유일 식별자
  - 생성 후 변경되지 않는다

- status
  - pending: 요청 접수
  - processing: 지급 처리 중
  - completed: 입금 완료
  - rejected: 반려
```

### 모델 문서에서 제거할 것

* API Path
* 화면 표시 순서
* 버튼/탭/모달 언급

## 4️⃣ UI 문서로 이관하는 기준 (프론트 기준 문서)

UI 문서는 **“언제 무엇을 호출하고 어떻게 보여주는가”**만 다룹니다.

### UI 문서에 남겨야 할 것

* 화면 진입 조건
* 호출 API
* 로딩 / 실패 / 빈 상태
* 서버 상태값 → UI 라벨 매핑

#### 예시

```md
### MerchantSettlement 화면

- 화면 진입 시
  - GET /merchant/settlements/balance 호출
- 요청 성공
  - 정산 가능 잔액 표시
- 실패(401)
  - 로그인 화면으로 이동
```

### UI 문서에서 제거할 것

* API 필드 상세 설명
* DB/모델 구조 설명

## 5️⃣ 공통 타입 / 에러 / 규칙은 “중앙 집중”

아래 항목은 **중복 정의 절대 금지**입니다.

* 공통 타입 (`IWC`, `ISODateString`)
* 공통 enum (`ProcessStatus`)
* 에러 코드

👉 위치:

```
docs/model/web-common-types.md
docs/model/web-error-codes.md
```

API/UI 문서에서는 **참조만** 합니다.

```md
상태값은 ProcessStatus 정의를 따른다.
(참조: docs/model/web-common-types.md)
```

## 6️⃣ `_index.md` (논리적 SSOT 허브) 작성 기준

이 파일이 **분리 구조를 하나로 묶는 접착제**입니다.

### 반드시 포함할 내용

```md
## SSOT 우선순위

1. API 계약: docs/design/api/*
2. 모델 의미: docs/model/*
3. UI 동작: docs/ui/*
4. 충돌 시 우선순위는 위 순서를 따른다

## Codegen 규칙

- Codegen 입력은 docs/design/api/* 만 사용한다
- docs/model/* 은 의미 참조용이다
- docs/ui/* 는 프론트 구현 기준이다
```

이 한 장이 없으면:

* “이건 API 문서에 있는데요?”
* “UI 문서에는 이렇게 써 있어요”
  논쟁이 다시 시작됩니다.

## 7️⃣ 이관 순서 (실제 작업 순서)

**절대 순서를 바꾸지 마세요.**

1. 기존 문서 백업 (원본 보존)
2. API 섹션 먼저 분리
3. 모델 섹션 분리
4. UI 섹션 분리
5. `_index.md` 작성
6. API 문서에 `@codegen` Marker 추가
7. Codegen 파싱 테스트

## 8️⃣ 이관 완료 체크리스트

* [ ] API 문서만 봐도 Codegen 가능
* [ ] UI 문서에 API 필드 정의 없음
* [ ] 모델 문서에 화면/버튼 언급 없음
* [ ] 공통 타입 단일 정의
* [ ] `_index.md`에 우선순위 명시
